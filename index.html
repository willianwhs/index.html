<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AjudaAi ‚Äî Servi√ßos perto de voc√™</title>

<style>
:root{
--azul:#1E3A8A;
--amarelo:#FFC107;
--cinza:#f4f6f8;
--whatsapp:#25D366;
}
body{margin:0;font-family:Arial;background:var(--cinza);color:#222}

/* HEADER */
header{
background:#fff;
padding:30px 20px;
text-align:center;
border-bottom:4px solid var(--amarelo);
}
header h1{margin:0;font-size:36px;font-weight:800}
.logo1{color:var(--azul)}
.logo2{color:var(--amarelo)}
header p{margin:12px auto;max-width:600px;font-size:18px}
.header-buttons{
margin-top:20px;
display:flex;
justify-content:center;
gap:12px;
flex-wrap:wrap;
}
.btn{
padding:14px 20px;
border-radius:12px;
border:none;
font-weight:bold;
cursor:pointer;
}
.btn-azul{background:var(--azul);color:#fff}
.btn-amarelo{background:var(--amarelo);color:#000}

/* MENU */
.menu{
display:flex;
flex-wrap:wrap;
gap:10px;
justify-content:center;
padding:20px;
}
.menu input{
padding:12px;
border-radius:10px;
border:1px solid #ccc;
min-width:240px;
}
.menu button{
padding:12px 16px;
border-radius:10px;
border:none;
cursor:pointer;
font-weight:bold;
}

/* MAPA */
#map{
max-width:1100px;
margin:20px auto;
height:260px;
border-radius:14px;
display:none;
}

/* CARDS */
.cards{
max-width:1100px;
margin:20px auto;
padding:20px;
display:grid;
grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
gap:20px;
}
.card{
background:#fff;
padding:20px;
border-radius:16px;
text-align:center;
box-shadow:0 8px 20px rgba(0,0,0,.08);
position:relative;
}
.selo{
position:absolute;
top:10px;
right:10px;
background:var(--azul);
color:#fff;
padding:4px 10px;
border-radius:20px;
font-size:12px;
}
.distancia{
margin:6px 0;
font-weight:bold;
color:var(--azul);
}
.botao{
display:block;
margin-top:8px;
padding:12px;
border-radius:10px;
text-decoration:none;
font-weight:bold;
}
.whatsapp{background:var(--whatsapp);color:#fff}
</style>
</head>

<body>

<header>
<h1><span class="logo1">Ajuda</span><span class="logo2">Ai</span></h1>
<p>Encontre prestadores de servi√ßos confi√°veis perto de voc√™, em poucos cliques.</p>

<div class="header-buttons">
<button class="btn btn-azul" onclick="ativarLocalizacao()">üìç Perto de mim</button>
<button class="btn btn-amarelo" onclick="alert('Cadastro em breve')">Sou prestador</button>
</div>
</header>

<div class="menu">
<input id="busca" placeholder="Buscar servi√ßo ou cidade">
<button onclick="buscar()">Buscar</button>
<button onclick="verificados()">‚úî Verificados</button>
<button onclick="resetar()">Limpar</button>
</div>

<div id="map"></div>
<div class="cards" id="lista"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<script>
const URL="https://raw.githubusercontent.com/willianwhs/ajudaai/main/prestadores.json";
let prestadores=[], map, markers=[];

fetch(URL).then(r=>r.json()).then(d=>prestadores=d);

function calcularDistancia(lat1,lng1,lat2,lng2){
const R=6371;
const dLat=(lat2-lat1)*Math.PI/180;
const dLng=(lng2-lng1)*Math.PI/180;
const a=Math.sin(dLat/2)**2+
Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
Math.sin(dLng/2)**2;
return R*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));
}

function ativarLocalizacao(){
navigator.geolocation.getCurrentPosition(pos=>{
prestadores.forEach(p=>{
p.distancia=calcularDistancia(pos.coords.latitude,pos.coords.longitude,p.lat,p.lng);
});
prestadores.sort((a,b)=>a.distancia-b.distancia);
mostrar(prestadores,true);
});
}

function buscar(){
const t=document.getElementById("busca").value.trim().toLowerCase();
const r=prestadores.filter(p=>
p.nome.toLowerCase().includes(t)||
p.servico.toLowerCase().includes(t)||
p.cidade.toLowerCase().includes(t)
);
mostrar(r,true);
}

function verificados(){
mostrar(prestadores.filter(p=>p.verificado),true);
}

function resetar(){
document.getElementById("lista").innerHTML="";
document.getElementById("map").style.display="none";
}

function mostrar(lista,mostrarMapa){
const c=document.getElementById("lista");
c.innerHTML="";
lista.forEach(p=>{
c.innerHTML+=`
<div class="card">
${p.verificado?'<div class="selo">‚úî Verificado</div>':''}
<h3>${p.nome}</h3>
<div>${p.servico}</div>
<div>${p.cidade}</div>
<div class="distancia">${p.distancia?`üìç ${p.distancia.toFixed(1)} km`:''}</div>
<div>${"‚≠ê".repeat(p.media||0)}</div>
<a class="botao whatsapp" href="https://wa.me/55${p.whatsapp}" target="_blank">WhatsApp</a>
</div>`;
});
if(mostrarMapa) desenharMapa(lista);
}

function desenharMapa(lista){
document.getElementById("map").style.display="block";
if(!map){
map=L.map('map').setView([-22.9,-47],6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
}
markers.forEach(m=>map.removeLayer(m));
markers=[];
lista.forEach(p=>{
const m=L.marker([p.lat,p.lng]).addTo(map).bindPopup(p.nome);
markers.push(m);
});
if(lista[0]) map.setView([lista[0].lat,lista[0].lng],12);
}
</script>

</body>
</html>
